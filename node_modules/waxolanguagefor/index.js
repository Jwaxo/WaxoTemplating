// an example for tag
module.exports = function(parser, contents) { 
	console.log("Attempting to run 'for' function.");
	var bits = contents.split(/\s+/)  // ["for", "item", "in", "items", "reversed"]
    , contextTarget = bits[1]
    , contextTargetVariables = parser.tags[bits[3]]

	parser.parse({
      'endfor': endfor
	})

	return function(string, content) {
		var target = contextTargetVariables;
		var output = [];
		var loopContext = {};
		var loopContent;
		var loopObject;

		if (bits[4] == 'reversed') {
			for(var i = target.length-1;i > -1;i--) {
				loopContext[contextTarget] = target[i];
				console.log("Context of loop is '" + loopContext + "'.");
				parser.parseTags(loopContext);
				loopContent = parser.search(content, null);
				console.log("Looped content is: '" + loopContent + "'.");
				output.push(loopContent);
			}
		} else {
			for(var i = 0;i < target.length;i++) {
				loopContext[contextTarget] = target[i];
				console.log("Context of loop is '" + loopContext + "'.");
				parser.parseTags(loopContext);
				loopContent = parser.search(content, null);

				output.push(loopContent);
			}
		}

		return output.join('')
	}

	function endfor(tpl, context) {
		return {
			tpl: tpl.substring(0, context.index)
		  , endpoint: context.index + context[0].length
		};
	}
}